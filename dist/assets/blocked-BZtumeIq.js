import{r as o,j as e,i as K,a as O,R as V}from"./theme-BWEU3csn.js";import{T as W,A as E}from"./timer-Du1xE-Yw.js";import{L,S as I,C as q}from"./shield-CTxgcE2S.js";function B(i){const c=Math.floor(i/3600),s=Math.floor(i%3600/60);return c>0?`${c}h ${s}m`:`${s}m`}function z(i){const c=Math.ceil(i/1e3),s=Math.floor(c/3600),u=Math.floor(c%3600/60),a=c%60;return s>0?`${s}h ${u}m ${a}s`:u>0?`${u}m ${a}s`:`${a}s`}function H(){const i=new Date,s=new Date(i.getFullYear(),i.getMonth(),i.getDate()+1,0,0,0).getTime()-i.getTime(),u=Math.floor(s/(1e3*60*60)),a=Math.floor(s%(1e3*60*60)/(1e3*60));return`${u}h ${a}m`}function J(i){return`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`}function Q(){const[i,c]=o.useState("site"),[s,u]=o.useState(null),[a,D]=o.useState(null),[x,N]=o.useState(""),[y,d]=o.useState(""),[b,p]=o.useState(!1),[k,C]=o.useState(!1),[h,T]=o.useState(0),[v,S]=o.useState(0),[w,_]=o.useState(null);o.useEffect(()=>{F()},[]),o.useEffect(()=>{if((s==null?void 0:s.unlockType)==="timer"&&w){const t=()=>{const n=w-Date.now();n<=0?window.history.back():S(n)};t();const r=setInterval(t,1e3);return()=>clearInterval(r)}},[s,w]),o.useEffect(()=>{if(h>0){const t=setTimeout(()=>T(h-1),1e3);return()=>clearTimeout(t)}else k&&h===0&&i==="limit"&&P()},[h,k,i]);async function F(){const t=new URLSearchParams(window.location.search),r=t.get("type"),n=t.get("site"),l=t.get("limitId");r==="limit"&&l?(c("limit"),await R(l)):n&&(c("site"),await U(n))}async function R(t){var r,n,l;try{const[j,m]=await Promise.all([chrome.runtime.sendMessage({type:"GET_DAILY_LIMITS"}),chrome.runtime.sendMessage({type:"GET_STATS",payload:{date:J(new Date)}})]),g=j.find(f=>f.id===t);if(g){const f=g.pattern.replace(/^www\./,""),Y=((r=m==null?void 0:m.sites)==null?void 0:r[f])||((n=m==null?void 0:m.sites)==null?void 0:n["www."+f])||((l=m==null?void 0:m.sites)==null?void 0:l[g.pattern])||0;D({limit:g,timeSpent:Y}),await chrome.runtime.sendMessage({type:"INCREMENT_BLOCKED_ATTEMPT",payload:{domain:g.pattern}})}}catch(j){console.error("Failed to load limit:",j)}}async function U(t){try{const n=(await chrome.runtime.sendMessage({type:"GET_BLOCKED_SITES"})).find(l=>l.id===t);if(u(n||null),(n==null?void 0:n.unlockType)==="timer"){const l=await chrome.runtime.sendMessage({type:"GET_TIMER_STATUS",payload:{id:t}});l!=null&&l.isActive&&l.blockedUntil&&(_(l.blockedUntil),S(l.remainingMs))}n&&await chrome.runtime.sendMessage({type:"INCREMENT_BLOCKED_ATTEMPT",payload:{domain:n.pattern}})}catch(r){console.error("Failed to load site:",r)}}async function $(t){if(t.preventDefault(),!(!s||!x)){p(!0),d("");try{const r=await chrome.runtime.sendMessage({type:"UNLOCK_SITE",payload:{id:s.id,password:x}});r.success?window.history.back():d(r.error||"Failed to unlock")}catch(r){console.error("Failed to unlock:",r),d("Failed to unlock site")}finally{p(!1)}}}function M(){window.history.back()}function A(){if(!a)return;const t=a.limit.cooldownSeconds||30;T(t),C(!0)}async function P(){if(a)try{const t=await chrome.runtime.sendMessage({type:"BYPASS_DAILY_LIMIT",payload:{id:a.limit.id}});t.success?window.history.back():d(t.error||"Failed to bypass limit")}catch(t){console.error("Failed to bypass limit:",t),d("Failed to bypass limit")}}async function G(t){if(t.preventDefault(),!(!a||!x)){p(!0),d("");try{const r=await chrome.runtime.sendMessage({type:"BYPASS_DAILY_LIMIT",payload:{id:a.limit.id,password:x}});r.success?window.history.back():d(r.error||"Failed to bypass limit")}catch(r){console.error("Failed to bypass limit:",r),d("Failed to bypass limit")}finally{p(!1)}}}return i==="limit"&&a?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-50 dark:from-gray-900 dark:to-amber-950 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100 dark:bg-amber-900/50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(W,{className:"w-8 h-8 text-amber-600 dark:text-amber-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Daily Limit Reached"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:a.limit.pattern})})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-amber-800 dark:text-amber-300",children:"Time spent today"}),e.jsx("span",{className:"font-medium text-amber-900 dark:text-amber-200",children:B(a.timeSpent)})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-amber-800 dark:text-amber-300",children:"Daily limit"}),e.jsx("span",{className:"font-medium text-amber-900 dark:text-amber-200",children:B(a.limit.limitSeconds)})]}),e.jsx("div",{className:"h-2 bg-amber-200 dark:bg-amber-900/50 rounded-full overflow-hidden mt-3",children:e.jsx("div",{className:"h-full bg-amber-500 rounded-full",style:{width:"100%"}})})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center mb-6",children:["Limit resets in ",H()]}),a.limit.bypassType==="cooldown"&&e.jsx("div",{className:"space-y-4",children:k?h>0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-4xl font-bold text-amber-600 dark:text-amber-400 mb-2",children:h}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Taking a moment to reconsider..."})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-amber-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Granting access..."})]}):e.jsxs("button",{onClick:A,className:"w-full bg-amber-600 hover:bg-amber-700 text-white py-3 rounded-lg transition-colors",children:["Wait ",a.limit.cooldownSeconds||30,"s to continue"]})}),a.limit.bypassType==="password"&&e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:"Enter password to continue for 15 minutes"})]}),e.jsx("input",{type:"password",value:x,onChange:t=>{N(t.target.value),d("")},placeholder:"Enter password",className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500",autoFocus:!0}),y&&e.jsx("p",{className:"text-sm text-red-600",children:y}),e.jsx("button",{type:"submit",disabled:b||!x,className:"w-full bg-amber-600 hover:bg-amber-700 disabled:opacity-50 text-white py-3 rounded-lg transition-colors",children:b?"Verifying...":"Continue for 15 minutes"})]}),a.limit.bypassType==="none"&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"This limit cannot be bypassed. Check back after midnight."})}),e.jsxs("button",{onClick:M,className:"w-full mt-4 flex items-center justify-center gap-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 py-2 transition-colors",children:[e.jsx(E,{className:"w-4 h-4"}),"Go Back"]}),e.jsx("div",{className:"mt-6 pt-6 border-t dark:border-gray-700 text-center",children:e.jsx("a",{href:chrome.runtime.getURL("dashboard.html#/limits"),className:"text-sm text-amber-600 hover:text-amber-700",children:"Manage daily limits in dashboard"})})]})}):s?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 dark:from-gray-900 dark:to-red-950 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(I,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Site Blocked"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:s.pattern})," is blocked"]})]}),s.unlockType==="password"&&e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:"Enter password to unlock temporarily"})]}),e.jsx("input",{type:"password",value:x,onChange:t=>{N(t.target.value),d("")},placeholder:"Enter password",className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0}),y&&e.jsx("p",{className:"text-sm text-red-600",children:y}),e.jsx("button",{type:"submit",disabled:b||!x,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white py-3 rounded-lg transition-colors",children:b?"Unlocking...":"Unlock Site"})]}),s.unlockType==="timer"&&v>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-800 dark:text-red-300 mb-3",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:"Temporary block active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600 dark:text-red-400 mb-1",children:z(v)}),e.jsx("p",{className:"text-sm text-red-600/70 dark:text-red-400/70",children:"remaining"})]})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:"This site will automatically unblock when the timer ends."})]}),s.unlockType==="none"&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"This site is permanently blocked. Go to the dashboard to change settings."})}),s.unlockType==="schedule"&&s.schedule&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"This site is blocked during scheduled hours."}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Blocked: ",s.schedule.startTime," - ",s.schedule.endTime]})]}),e.jsxs("button",{onClick:M,className:"w-full mt-4 flex items-center justify-center gap-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 py-2 transition-colors",children:[e.jsx(E,{className:"w-4 h-4"}),"Go Back"]}),e.jsx("div",{className:"mt-6 pt-6 border-t dark:border-gray-700 text-center",children:e.jsx("a",{href:chrome.runtime.getURL("dashboard.html#/blocked"),className:"text-sm text-blue-600 hover:text-blue-700",children:"Manage blocked sites in dashboard"})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 dark:from-gray-900 dark:to-red-950 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(I,{className:"w-16 h-16 text-red-500 dark:text-red-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Site Blocked"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"This site has been blocked by BrowserUtils."})]})})}K();O.createRoot(document.getElementById("root")).render(e.jsx(V.StrictMode,{children:e.jsx(Q,{})}));
