const y={trackingEnabled:!0,blockingEnabled:!0,theme:"system",retentionDays:30,idleThreshold:60,displayName:"",quickLinks:[]},o={BLOCKED_SITES:"blockedSites",BLOCKED_SITE_FOLDERS:"blockedSiteFolders",SETTINGS:"settings",DAILY_STATS:"dailyStats",ACTIVE_SESSIONS:"activeSessions"};async function r(){return(await chrome.storage.local.get(o.BLOCKED_SITES))[o.BLOCKED_SITES]||[]}async function l(t){await chrome.storage.local.set({[o.BLOCKED_SITES]:t})}async function D(t){const s=await r(),e={...t,id:crypto.randomUUID(),createdAt:Date.now()};return s.push(e),await l(s),e}async function p(t){const e=(await r()).filter(a=>a.id!==t);await l(e)}async function _(t){const s=await r(),e=s.findIndex(a=>a.id===t.id);e!==-1&&(s[e]=t,await l(s))}async function S(){return(await chrome.storage.local.get(o.BLOCKED_SITE_FOLDERS))[o.BLOCKED_SITE_FOLDERS]||[]}async function d(t){await chrome.storage.local.set({[o.BLOCKED_SITE_FOLDERS]:t})}async function L(t){const s=await S(),e={...t,id:crypto.randomUUID()};return s.push(e),await d(s),e}async function k(t){const s=await S(),e=s.findIndex(a=>a.id===t.id);e!==-1&&(s[e]=t,await d(s))}async function B(t){const e=(await S()).filter(n=>n.id!==t);await d(e);const c=(await r()).map(n=>n.folderId===t?{...n,folderId:void 0}:n);await l(c)}async function E(){const t=await chrome.storage.local.get(o.SETTINGS);return{...y,...t[o.SETTINGS]}}async function O(t){const e={...await E(),...t};return await chrome.storage.local.set({[o.SETTINGS]:e}),e}function u(t=new Date){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}async function m(t){const s=t||u();return((await chrome.storage.local.get(o.DAILY_STATS))[o.DAILY_STATS]||{})[s]||{date:s,totalTime:0,sites:{},visits:0,blockedAttempts:0,sessions:[]}}async function v(){return(await chrome.storage.local.get(o.DAILY_STATS))[o.DAILY_STATS]||{}}async function w(t,s){const a=(await chrome.storage.local.get(o.DAILY_STATS))[o.DAILY_STATS]||{};a[t]=s,await chrome.storage.local.set({[o.DAILY_STATS]:a})}async function F(t){const s=u(),e=await m(s);e.blockedAttempts++,await w(s,e)}function f(t){if(t.length===0)return{merged:[],totalSeconds:0};const s=[...t].sort((c,n)=>c.start-n.start),e=[s[0]];for(let c=1;c<s.length;c++){const n=s[c],i=e[e.length-1];n.start<=i.end?i.end=Math.max(i.end,n.end):e.push(n)}const a=e.reduce((c,n)=>c+Math.round((n.end-n.start)/1e3),0);return{merged:e,totalSeconds:a}}function I(t){const s=t.map(n=>({start:n.startTime,end:n.endTime})),{totalSeconds:e}=f(s),a=new Map;for(const n of t){const i=a.get(n.domain)||[];i.push({start:n.startTime,end:n.endTime}),a.set(n.domain,i)}const c={};for(const[n,i]of a){const{totalSeconds:h}=f(i);c[n]=h}return{totalTime:e,sites:c}}async function C(t){const s=new Date(t.startTime),e=u(s),a=await m(e);a.sessions||(a.sessions=[]),a.sessions.push(t),a.visits++;const c=I(a.sessions);a.totalTime=c.totalTime,a.sites=c.sites,await w(e,a)}async function T(){return(await chrome.storage.local.get(o.ACTIVE_SESSIONS))[o.ACTIVE_SESSIONS]||{}}async function g(t){await chrome.storage.local.set({[o.ACTIVE_SESSIONS]:t})}async function b(t,s){const e=await T();e[t]=s,await g(e)}async function N(t){const s=await T(),e=s[t];return e&&(delete s[t],await g(s)),e}async function Y(){await chrome.storage.local.remove(o.ACTIVE_SESSIONS)}async function A(t){const e=new TextEncoder().encode(t),a=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(a)).map(n=>n.toString(16).padStart(2,"0")).join("")}async function K(t,s){return await A(t)===s}function x(t,s){try{const a=new URL(t).hostname;if(s.startsWith("*.")){const c=s.slice(2);return a===c||a.endsWith("."+c)}return a===s||a==="www."+s}catch{return!1}}export{T as a,L as b,S as c,O as d,r as e,l as f,E as g,A as h,F as i,_ as j,p as k,D as l,m,v as n,C as o,b as p,x as q,B as r,d as s,N as t,k as u,K as v,Y as w};
