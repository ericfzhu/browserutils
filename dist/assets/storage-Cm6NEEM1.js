const _={trackingEnabled:!0,blockingEnabled:!0,youtubeTrackingEnabled:!1,theme:"system",retentionDays:30,idleThreshold:60,displayName:"",quickLinks:[]},i={BLOCKED_SITES:"blockedSites",BLOCKED_SITE_FOLDERS:"blockedSiteFolders",SETTINGS:"settings",DAILY_STATS:"dailyStats",ACTIVE_SESSIONS:"activeSessions",ACTIVE_YOUTUBE_SESSIONS:"activeYouTubeSessions",DOMAIN_CATEGORIES:"domainCategories",DAILY_LIMITS:"dailyLimits"};async function d(){return(await chrome.storage.local.get(i.BLOCKED_SITES))[i.BLOCKED_SITES]||[]}async function m(t){await chrome.storage.local.set({[i.BLOCKED_SITES]:t})}async function v(t){const e=await d(),s={...t,id:crypto.randomUUID(),createdAt:Date.now()};return e.push(s),await m(e),s}async function B(t){const s=(await d()).filter(o=>o.id!==t);await m(s)}async function C(t){const e=await d(),s=e.findIndex(o=>o.id===t.id);s!==-1&&(e[s]=t,await m(e))}async function w(){return(await chrome.storage.local.get(i.BLOCKED_SITE_FOLDERS))[i.BLOCKED_SITE_FOLDERS]||[]}async function y(t){await chrome.storage.local.set({[i.BLOCKED_SITE_FOLDERS]:t})}async function k(t){const e=await w(),s={...t,id:crypto.randomUUID()};return e.push(s),await y(e),s}async function U(t){const e=await w(),s=e.findIndex(o=>o.id===t.id);s!==-1&&(e[s]=t,await y(e))}async function N(t){const s=(await w()).filter(a=>a.id!==t);await y(s);const n=(await d()).map(a=>a.folderId===t?{...a,folderId:void 0}:a);await m(n)}async function p(){const t=await chrome.storage.local.get(i.SETTINGS);return{..._,...t[i.SETTINGS]}}async function x(t){const s={...await p(),...t};return await chrome.storage.local.set({[i.SETTINGS]:s}),s}function u(t=new Date){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}async function h(t){const e=t||u(),n=((await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{})[e];return n?(n.youtubeSessions||(n.youtubeSessions=[]),n):{date:e,totalTime:0,sites:{},visits:0,blockedAttempts:0,sessions:[],youtubeSessions:[]}}async function F(){return(await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{}}async function L(t,e){const o=(await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{};o[t]=e,await chrome.storage.local.set({[i.DAILY_STATS]:o})}async function M(t){const e=u(),s=await h(e);s.blockedAttempts++,await L(e,s)}function T(t){if(t.length===0)return{merged:[],totalSeconds:0};const e=[...t].sort((n,a)=>n.start-a.start),s=[e[0]];for(let n=1;n<e.length;n++){const a=e[n],c=s[s.length-1];a.start<=c.end?c.end=Math.max(c.end,a.end):s.push(a)}const o=s.reduce((n,a)=>n+Math.round((a.end-a.start)/1e3),0);return{merged:s,totalSeconds:o}}function O(t){const e=t.map(a=>({start:a.startTime,end:a.endTime})),{totalSeconds:s}=T(e),o=new Map;for(const a of t){const c=o.get(a.domain)||[];c.push({start:a.startTime,end:a.endTime}),o.set(a.domain,c)}const n={};for(const[a,c]of o){const{totalSeconds:r}=T(c);n[a]=r}return{totalTime:s,sites:n}}async function G(t){const e=new Date(t.startTime),s=u(e),n=(await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{},a=n[s]||{date:s,totalTime:0,sites:{},visits:0,blockedAttempts:0,sessions:[],youtubeSessions:[]};a.sessions||(a.sessions=[]),a.sessions.push(t),a.visits++;const c=O(a.sessions);a.totalTime=c.totalTime,a.sites=c.sites,a.youtubeSessions||(a.youtubeSessions=[]),n[s]=a,await chrome.storage.local.set({[i.DAILY_STATS]:n})}function R(t){const e=new Map,s=new Map;for(const n of t){const a=n.channelName,c=e.get(a)||[];c.push({start:n.startTime,end:n.endTime}),e.set(a,c),n.channelUrl&&s.set(a,n.channelUrl)}const o={};for(const[n,a]of e){const{totalSeconds:c}=T(a);o[n]={time:c,url:s.get(n)}}return o}async function V(t){const e=new Date(t.startTime),s=u(e),n=(await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{},a=n[s]||{date:s,totalTime:0,sites:{},visits:0,blockedAttempts:0,sessions:[],youtubeSessions:[]};a.youtubeSessions||(a.youtubeSessions=[]),a.youtubeSessions.push(t),n[s]=a,await chrome.storage.local.set({[i.DAILY_STATS]:n})}async function g(){return(await chrome.storage.local.get(i.ACTIVE_YOUTUBE_SESSIONS))[i.ACTIVE_YOUTUBE_SESSIONS]||{}}async function A(t){await chrome.storage.local.set({[i.ACTIVE_YOUTUBE_SESSIONS]:t})}async function K(t,e){const s=await g();s[t]=e,await A(s)}async function W(t){const e=await g(),s=e[t];return s&&(delete e[t],await A(e)),s}async function H(){await chrome.storage.local.remove(i.ACTIVE_YOUTUBE_SESSIONS)}async function D(){return(await chrome.storage.local.get(i.ACTIVE_SESSIONS))[i.ACTIVE_SESSIONS]||{}}async function E(t){await chrome.storage.local.set({[i.ACTIVE_SESSIONS]:t})}async function P(t,e){const s=await D();s[t]=e,await E(s)}async function j(t){const e=await D(),s=e[t];return s&&(delete e[t],await E(e)),s}async function $(){await chrome.storage.local.remove(i.ACTIVE_SESSIONS)}async function b(t){const s=new TextEncoder().encode(t),o=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(o)).map(a=>a.toString(16).padStart(2,"0")).join("")}async function q(t,e){return await b(t)===e}function z(t,e){try{const s=new URL(t),o=s.hostname,n=s.pathname,a=e.includes("/");let c,r=null;if(a){const S=e.indexOf("/");c=e.slice(0,S),r=e.slice(S),r.endsWith("/*")&&(r=r.slice(0,-2))}else c=e;let l=!1;if(c.startsWith("*.")){const S=c.slice(2);l=o===S||o.endsWith("."+S)}else l=o===c||o==="www."+c;return l?r?n===r||n.startsWith(r+"/"):!0:!1}catch{return!1}}async function Y(){return(await chrome.storage.local.get(i.DOMAIN_CATEGORIES))[i.DOMAIN_CATEGORIES]||{}}async function J(t,e){const s=await Y();e===null?delete s[t]:s[t]=e,await chrome.storage.local.set({[i.DOMAIN_CATEGORIES]:s})}async function f(){return(await chrome.storage.local.get(i.DAILY_LIMITS))[i.DAILY_LIMITS]||[]}async function I(t){await chrome.storage.local.set({[i.DAILY_LIMITS]:t})}async function Q(t){const e=await f(),s={...t,id:crypto.randomUUID()};return e.push(s),await I(e),s}async function X(t){const e=await f(),s=e.findIndex(o=>o.id===t.id);s!==-1&&(e[s]=t,await I(e))}async function Z(t){const s=(await f()).filter(o=>o.id!==t);await I(s)}async function tt(t){const e=await f(),s=u(),o=await h(s);for(const n of e){if(!n.enabled||n.bypassedUntil&&Date.now()<n.bypassedUntil)continue;const a=t.replace(/^www\./,""),c=n.pattern.replace(/^www\./,"");let r=!1;if(c.startsWith("*.")){const l=c.slice(2);r=a===l||a.endsWith("."+l)}else r=a===c;if(r){const l=o.sites[t]||o.sites["www."+t]||o.sites[a]||0,S=Math.max(0,n.limitSeconds-l);return{exceeded:l>=n.limitSeconds,limit:n,timeSpent:l,remaining:S}}}return{exceeded:!1,timeSpent:0,remaining:1/0}}export{F as A,G as B,P as C,K as D,W as E,V as F,H as G,z as H,j as I,$ as J,D as a,g as b,R as c,tt as d,Q as e,f,p as g,b as h,Y as i,N as j,y as k,U as l,k as m,w as n,M as o,x as p,d as q,Z as r,J as s,m as t,X as u,q as v,C as w,B as x,v as y,h as z};
