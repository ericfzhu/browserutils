const _={trackingEnabled:!0,blockingEnabled:!0,youtubeTrackingEnabled:!1,theme:"system",retentionDays:30,idleThreshold:60,displayName:"",quickLinks:[]},i={BLOCKED_SITES:"blockedSites",BLOCKED_SITE_FOLDERS:"blockedSiteFolders",SETTINGS:"settings",DAILY_STATS:"dailyStats",ACTIVE_SESSIONS:"activeSessions",ACTIVE_YOUTUBE_SESSIONS:"activeYouTubeSessions",DOMAIN_CATEGORIES:"domainCategories",DAILY_LIMITS:"dailyLimits"};async function d(){return(await chrome.storage.local.get(i.BLOCKED_SITES))[i.BLOCKED_SITES]||[]}async function m(t){await chrome.storage.local.set({[i.BLOCKED_SITES]:t})}async function b(t){const e=await d(),s={...t,id:crypto.randomUUID(),createdAt:Date.now()};return e.push(s),await m(e),s}async function B(t){const s=(await d()).filter(a=>a.id!==t);await m(s)}async function C(t){const e=await d(),s=e.findIndex(a=>a.id===t.id);s!==-1&&(e[s]=t,await m(e))}async function I(){return(await chrome.storage.local.get(i.BLOCKED_SITE_FOLDERS))[i.BLOCKED_SITE_FOLDERS]||[]}async function h(t){await chrome.storage.local.set({[i.BLOCKED_SITE_FOLDERS]:t})}async function k(t){const e=await I(),s={...t,id:crypto.randomUUID()};return e.push(s),await h(e),s}async function N(t){const e=await I(),s=e.findIndex(a=>a.id===t.id);s!==-1&&(e[s]=t,await h(e))}async function U(t){const s=(await I()).filter(n=>n.id!==t);await h(s);const o=(await d()).map(n=>n.folderId===t?{...n,folderId:void 0}:n);await m(o)}async function L(){const t=await chrome.storage.local.get(i.SETTINGS);return{..._,...t[i.SETTINGS]}}async function F(t){const s={...await L(),...t};return await chrome.storage.local.set({[i.SETTINGS]:s}),s}function u(t=new Date){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}async function f(t){const e=t||u();return((await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{})[e]||{date:e,totalTime:0,sites:{},visits:0,blockedAttempts:0,sessions:[]}}async function x(){return(await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{}}async function y(t,e){const a=(await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{};a[t]=e,await chrome.storage.local.set({[i.DAILY_STATS]:a})}async function M(t){const e=u(),s=await f(e);s.blockedAttempts++,await y(e,s)}function T(t){if(t.length===0)return{merged:[],totalSeconds:0};const e=[...t].sort((o,n)=>o.start-n.start),s=[e[0]];for(let o=1;o<e.length;o++){const n=e[o],c=s[s.length-1];n.start<=c.end?c.end=Math.max(c.end,n.end):s.push(n)}const a=s.reduce((o,n)=>o+Math.round((n.end-n.start)/1e3),0);return{merged:s,totalSeconds:a}}function O(t){const e=t.map(n=>({start:n.startTime,end:n.endTime})),{totalSeconds:s}=T(e),a=new Map;for(const n of t){const c=a.get(n.domain)||[];c.push({start:n.startTime,end:n.endTime}),a.set(n.domain,c)}const o={};for(const[n,c]of a){const{totalSeconds:r}=T(c);o[n]=r}return{totalTime:s,sites:o}}async function G(t){const e=new Date(t.startTime),s=u(e),a=await f(s);a.sessions||(a.sessions=[]),a.sessions.push(t),a.visits++;const o=O(a.sessions);a.totalTime=o.totalTime,a.sites=o.sites,await y(s,a)}function R(t){const e=new Map;for(const a of t){const o=a.channelId||a.channelName,n=e.get(o)||[];n.push({start:a.startTime,end:a.endTime}),e.set(o,n)}const s={};for(const[a,o]of e){const{totalSeconds:n}=T(o),c=t.find(r=>(r.channelId||r.channelName)===a);c&&(s[c.channelName]=n)}return s}async function V(t){const e=new Date(t.startTime),s=u(e),a=await f(s);a.youtubeSessions||(a.youtubeSessions=[]),a.youtubeSessions.push(t),await y(s,a)}async function E(){return(await chrome.storage.local.get(i.ACTIVE_YOUTUBE_SESSIONS))[i.ACTIVE_YOUTUBE_SESSIONS]||{}}async function A(t){await chrome.storage.local.set({[i.ACTIVE_YOUTUBE_SESSIONS]:t})}async function K(t,e){const s=await E();s[t]=e,await A(s)}async function W(t){const e=await E(),s=e[t];return s&&(delete e[t],await A(e)),s}async function H(){await chrome.storage.local.remove(i.ACTIVE_YOUTUBE_SESSIONS)}async function D(){return(await chrome.storage.local.get(i.ACTIVE_SESSIONS))[i.ACTIVE_SESSIONS]||{}}async function p(t){await chrome.storage.local.set({[i.ACTIVE_SESSIONS]:t})}async function P(t,e){const s=await D();s[t]=e,await p(s)}async function j(t){const e=await D(),s=e[t];return s&&(delete e[t],await p(e)),s}async function $(){await chrome.storage.local.remove(i.ACTIVE_SESSIONS)}async function v(t){const s=new TextEncoder().encode(t),a=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(a)).map(n=>n.toString(16).padStart(2,"0")).join("")}async function q(t,e){return await v(t)===e}function z(t,e){try{const s=new URL(t),a=s.hostname,o=s.pathname,n=e.includes("/");let c,r=null;if(n){const S=e.indexOf("/");c=e.slice(0,S),r=e.slice(S),r.endsWith("/*")&&(r=r.slice(0,-2))}else c=e;let l=!1;if(c.startsWith("*.")){const S=c.slice(2);l=a===S||a.endsWith("."+S)}else l=a===c||a==="www."+c;return l?r?o===r||o.startsWith(r+"/"):!0:!1}catch{return!1}}async function Y(){return(await chrome.storage.local.get(i.DOMAIN_CATEGORIES))[i.DOMAIN_CATEGORIES]||{}}async function J(t,e){const s=await Y();e===null?delete s[t]:s[t]=e,await chrome.storage.local.set({[i.DOMAIN_CATEGORIES]:s})}async function w(){return(await chrome.storage.local.get(i.DAILY_LIMITS))[i.DAILY_LIMITS]||[]}async function g(t){await chrome.storage.local.set({[i.DAILY_LIMITS]:t})}async function Q(t){const e=await w(),s={...t,id:crypto.randomUUID()};return e.push(s),await g(e),s}async function X(t){const e=await w(),s=e.findIndex(a=>a.id===t.id);s!==-1&&(e[s]=t,await g(e))}async function Z(t){const s=(await w()).filter(a=>a.id!==t);await g(s)}async function tt(t){const e=await w(),s=u(),a=await f(s);for(const o of e){if(!o.enabled||o.bypassedUntil&&Date.now()<o.bypassedUntil)continue;const n=t.replace(/^www\./,""),c=o.pattern.replace(/^www\./,"");let r=!1;if(c.startsWith("*.")){const l=c.slice(2);r=n===l||n.endsWith("."+l)}else r=n===c;if(r){const l=a.sites[t]||a.sites["www."+t]||a.sites[n]||0,S=Math.max(0,o.limitSeconds-l);return{exceeded:l>=o.limitSeconds,limit:o,timeSpent:l,remaining:S}}}return{exceeded:!1,timeSpent:0,remaining:1/0}}export{P as A,E as B,K as C,W as D,V as E,H as F,q as G,z as H,j as I,$ as J,D as a,tt as b,R as c,Q as d,w as e,Y as f,L as g,v as h,U as i,h as j,N as k,k as l,I as m,M as n,F as o,d as p,m as q,Z as r,J as s,C as t,X as u,B as v,b as w,f as x,x as y,G as z};
