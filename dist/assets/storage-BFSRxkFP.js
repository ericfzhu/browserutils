const p={trackingEnabled:!0,blockingEnabled:!0,youtubeTrackingEnabled:!1,theme:"system",retentionDays:30,idleThreshold:60,displayName:"",quickLinks:[]},o={BLOCKED_SITES:"blockedSites",BLOCKED_SITE_FOLDERS:"blockedSiteFolders",SETTINGS:"settings",DAILY_STATS:"dailyStats",ACTIVE_SESSIONS:"activeSessions",ACTIVE_YOUTUBE_SESSIONS:"activeYouTubeSessions",DOMAIN_CATEGORIES:"domainCategories",DAILY_LIMITS:"dailyLimits",CUSTOM_CATEGORIES:"customCategories",BUILTIN_CATEGORY_OVERRIDES:"builtInCategoryOverrides"};async function d(){return(await chrome.storage.local.get(o.BLOCKED_SITES))[o.BLOCKED_SITES]||[]}async function m(t){await chrome.storage.local.set({[o.BLOCKED_SITES]:t})}async function B(t){const s=await d(),e={...t,id:crypto.randomUUID(),createdAt:Date.now()};return s.push(e),await m(s),e}async function N(t){const e=(await d()).filter(i=>i.id!==t);await m(e)}async function R(t){const s=await d(),e=s.findIndex(i=>i.id===t.id);e!==-1&&(s[e]=t,await m(s))}async function I(){return(await chrome.storage.local.get(o.BLOCKED_SITE_FOLDERS))[o.BLOCKED_SITE_FOLDERS]||[]}async function w(t){await chrome.storage.local.set({[o.BLOCKED_SITE_FOLDERS]:t})}async function k(t){const s=await I(),e={...t,id:crypto.randomUUID()};return s.push(e),await w(s),e}async function M(t){const s=await I(),e=s.findIndex(i=>i.id===t.id);e!==-1&&(s[e]=t,await w(s))}async function G(t){const e=(await I()).filter(a=>a.id!==t);await w(e);const n=(await d()).map(a=>a.folderId===t?{...a,folderId:void 0}:a);await m(n)}async function L(){const t=await chrome.storage.local.get(o.SETTINGS);return{...p,...t[o.SETTINGS]}}async function x(t){const e={...await L(),...t};return await chrome.storage.local.set({[o.SETTINGS]:e}),e}function S(t=new Date){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}async function h(t){const s=t||S(),n=((await chrome.storage.local.get(o.DAILY_STATS))[o.DAILY_STATS]||{})[s];return n?(n.youtubeSessions||(n.youtubeSessions=[]),n):{date:s,totalTime:0,sites:{},visits:0,blockedAttempts:0,sessions:[],youtubeSessions:[]}}async function F(){return(await chrome.storage.local.get(o.DAILY_STATS))[o.DAILY_STATS]||{}}async function b(t,s){const i=(await chrome.storage.local.get(o.DAILY_STATS))[o.DAILY_STATS]||{};i[t]=s,await chrome.storage.local.set({[o.DAILY_STATS]:i})}async function V(t){const s=S(),e=await h(s);e.blockedAttempts++,await b(s,e)}function T(t){if(t.length===0)return{merged:[],totalSeconds:0};const s=[...t].sort((n,a)=>n.start-a.start),e=[s[0]];for(let n=1;n<s.length;n++){const a=s[n],c=e[e.length-1];a.start<=c.end?c.end=Math.max(c.end,a.end):e.push(a)}const i=e.reduce((n,a)=>n+Math.round((a.end-a.start)/1e3),0);return{merged:e,totalSeconds:i}}function Y(t){const s=t.map(a=>({start:a.startTime,end:a.endTime})),{totalSeconds:e}=T(s),i=new Map;for(const a of t){const c=i.get(a.domain)||[];c.push({start:a.startTime,end:a.endTime}),i.set(a.domain,c)}const n={};for(const[a,c]of i){const{totalSeconds:r}=T(c);n[a]=r}return{totalTime:e,sites:n}}async function K(t){const s=new Date(t.startTime),e=S(s),n=(await chrome.storage.local.get(o.DAILY_STATS))[o.DAILY_STATS]||{},a=n[e]||{date:e,totalTime:0,sites:{},visits:0,blockedAttempts:0,sessions:[],youtubeSessions:[]};a.sessions||(a.sessions=[]),a.sessions.push(t),a.visits++;const c=Y(a.sessions);a.totalTime=c.totalTime,a.sites=c.sites,a.youtubeSessions||(a.youtubeSessions=[]),n[e]=a,await chrome.storage.local.set({[o.DAILY_STATS]:n})}function W(t){const s=new Map,e=new Map;for(const n of t){const a=n.channelName,c=s.get(a)||[];c.push({start:n.startTime,end:n.endTime}),s.set(a,c),n.channelUrl&&e.set(a,n.channelUrl)}const i={};for(const[n,a]of s){const{totalSeconds:c}=T(a);i[n]={time:c,url:e.get(n)}}return i}async function P(t){const s=new Date(t.startTime),e=S(s),n=(await chrome.storage.local.get(o.DAILY_STATS))[o.DAILY_STATS]||{},a=n[e]||{date:e,totalTime:0,sites:{},visits:0,blockedAttempts:0,sessions:[],youtubeSessions:[]};a.youtubeSessions||(a.youtubeSessions=[]),a.youtubeSessions.push(t),n[e]=a,await chrome.storage.local.set({[o.DAILY_STATS]:n})}async function A(){return(await chrome.storage.local.get(o.ACTIVE_YOUTUBE_SESSIONS))[o.ACTIVE_YOUTUBE_SESSIONS]||{}}async function D(t){await chrome.storage.local.set({[o.ACTIVE_YOUTUBE_SESSIONS]:t})}async function H(t,s){const e=await A();e[t]=s,await D(e)}async function j(t){const s=await A(),e=s[t];return e&&(delete s[t],await D(s)),e}async function $(){await chrome.storage.local.remove(o.ACTIVE_YOUTUBE_SESSIONS)}async function _(){return(await chrome.storage.local.get(o.ACTIVE_SESSIONS))[o.ACTIVE_SESSIONS]||{}}async function O(t){await chrome.storage.local.set({[o.ACTIVE_SESSIONS]:t})}async function q(t,s){const e=await _();e[t]=s,await O(e)}async function z(t){const s=await _(),e=s[t];return e&&(delete s[t],await O(s)),e}async function J(){await chrome.storage.local.remove(o.ACTIVE_SESSIONS)}async function v(t){const e=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(i)).map(a=>a.toString(16).padStart(2,"0")).join("")}async function Q(t,s){return await v(t)===s}function X(t,s){try{const e=new URL(t),i=e.hostname,n=e.pathname,a=s.includes("/");let c,r=null;if(a){const u=s.indexOf("/");c=s.slice(0,u),r=s.slice(u),r.endsWith("/*")&&(r=r.slice(0,-2))}else c=s;let l=!1;if(c.startsWith("*.")){const u=c.slice(2);l=i===u||i.endsWith("."+u)}else l=i===c||i==="www."+c;return l?r?n===r||n.startsWith(r+"/"):!0:!1}catch{return!1}}async function C(){return(await chrome.storage.local.get(o.DOMAIN_CATEGORIES))[o.DOMAIN_CATEGORIES]||{}}async function Z(t,s){const e=await C();s===null?delete e[t]:e[t]=s,await chrome.storage.local.set({[o.DOMAIN_CATEGORIES]:e})}async function g(){return(await chrome.storage.local.get(o.CUSTOM_CATEGORIES))[o.CUSTOM_CATEGORIES]||[]}async function y(t){await chrome.storage.local.set({[o.CUSTOM_CATEGORIES]:t})}async function tt(t){const s=await g(),e={...t,id:crypto.randomUUID()};return s.push(e),await y(s),e}async function et(t){const s=await g(),e=s.findIndex(i=>i.id===t.id);e!==-1&&(s[e]=t,await y(s))}async function st(t){const e=(await g()).filter(a=>a.id!==t);await y(e);const i=await C(),n={};for(const[a,c]of Object.entries(i))c!==t&&(n[a]=c);await chrome.storage.local.set({[o.DOMAIN_CATEGORIES]:n})}async function U(){return(await chrome.storage.local.get(o.BUILTIN_CATEGORY_OVERRIDES))[o.BUILTIN_CATEGORY_OVERRIDES]||{}}async function at(t,s){const e=await U();s===null?delete e[t]:e[t]=s,await chrome.storage.local.set({[o.BUILTIN_CATEGORY_OVERRIDES]:e})}async function f(){return(await chrome.storage.local.get(o.DAILY_LIMITS))[o.DAILY_LIMITS]||[]}async function E(t){await chrome.storage.local.set({[o.DAILY_LIMITS]:t})}async function nt(t){const s=await f(),e={...t,id:crypto.randomUUID()};return s.push(e),await E(s),e}async function ot(t){const s=await f(),e=s.findIndex(i=>i.id===t.id);e!==-1&&(s[e]=t,await E(s))}async function it(t){const e=(await f()).filter(i=>i.id!==t);await E(e)}async function ct(t){const s=await f(),e=S(),i=await h(e);for(const n of s){if(!n.enabled||n.bypassedUntil&&Date.now()<n.bypassedUntil)continue;const a=t.replace(/^www\./,""),c=n.pattern.replace(/^www\./,"");let r=!1;if(c.startsWith("*.")){const l=c.slice(2);r=a===l||a.endsWith("."+l)}else r=a===c;if(r){const l=i.sites[t]||i.sites["www."+t]||i.sites[a]||0,u=Math.max(0,n.limitSeconds-l);return{exceeded:l>=n.limitSeconds,limit:n,timeSpent:l,remaining:u}}}return{exceeded:!1,timeSpent:0,remaining:1/0}}export{x as A,d as B,m as C,R as D,N as E,B as F,h as G,F as H,K as I,q as J,H as K,j as L,P as M,$ as N,X as O,z as P,J as Q,_ as a,A as b,W as c,ct as d,nt as e,f,L as g,v as h,U as i,st as j,y as k,et as l,tt as m,g as n,Z as o,C as p,G as q,it as r,at as s,w as t,ot as u,Q as v,M as w,k as x,I as y,V as z};
