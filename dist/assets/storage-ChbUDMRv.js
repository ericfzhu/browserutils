const E={trackingEnabled:!0,blockingEnabled:!0,theme:"system",retentionDays:30,idleThreshold:60,displayName:"",quickLinks:[]},i={BLOCKED_SITES:"blockedSites",BLOCKED_SITE_FOLDERS:"blockedSiteFolders",SETTINGS:"settings",DAILY_STATS:"dailyStats",ACTIVE_SESSIONS:"activeSessions",DOMAIN_CATEGORIES:"domainCategories",DAILY_LIMITS:"dailyLimits"};async function d(){return(await chrome.storage.local.get(i.BLOCKED_SITES))[i.BLOCKED_SITES]||[]}async function S(t){await chrome.storage.local.set({[i.BLOCKED_SITES]:t})}async function k(t){const e=await d(),s={...t,id:crypto.randomUUID(),createdAt:Date.now()};return e.push(s),await S(e),s}async function B(t){const s=(await d()).filter(a=>a.id!==t);await S(s)}async function C(t){const e=await d(),s=e.findIndex(a=>a.id===t.id);s!==-1&&(e[s]=t,await S(e))}async function f(){return(await chrome.storage.local.get(i.BLOCKED_SITE_FOLDERS))[i.BLOCKED_SITE_FOLDERS]||[]}async function w(t){await chrome.storage.local.set({[i.BLOCKED_SITE_FOLDERS]:t})}async function v(t){const e=await f(),s={...t,id:crypto.randomUUID()};return e.push(s),await w(e),s}async function b(t){const e=await f(),s=e.findIndex(a=>a.id===t.id);s!==-1&&(e[s]=t,await w(e))}async function F(t){const s=(await f()).filter(n=>n.id!==t);await w(s);const o=(await d()).map(n=>n.folderId===t?{...n,folderId:void 0}:n);await S(o)}async function L(){const t=await chrome.storage.local.get(i.SETTINGS);return{...E,...t[i.SETTINGS]}}async function N(t){const s={...await L(),...t};return await chrome.storage.local.set({[i.SETTINGS]:s}),s}function u(t=new Date){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}async function g(t){const e=t||u();return((await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{})[e]||{date:e,totalTime:0,sites:{},visits:0,blockedAttempts:0,sessions:[]}}async function Y(){return(await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{}}async function T(t,e){const a=(await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{};a[t]=e,await chrome.storage.local.set({[i.DAILY_STATS]:a})}async function x(t){const e=u(),s=await g(e);s.blockedAttempts++,await T(e,s)}function I(t){if(t.length===0)return{merged:[],totalSeconds:0};const e=[...t].sort((o,n)=>o.start-n.start),s=[e[0]];for(let o=1;o<e.length;o++){const n=e[o],c=s[s.length-1];n.start<=c.end?c.end=Math.max(c.end,n.end):s.push(n)}const a=s.reduce((o,n)=>o+Math.round((n.end-n.start)/1e3),0);return{merged:s,totalSeconds:a}}function p(t){const e=t.map(n=>({start:n.startTime,end:n.endTime})),{totalSeconds:s}=I(e),a=new Map;for(const n of t){const c=a.get(n.domain)||[];c.push({start:n.startTime,end:n.endTime}),a.set(n.domain,c)}const o={};for(const[n,c]of a){const{totalSeconds:l}=I(c);o[n]=l}return{totalTime:s,sites:o}}async function M(t){const e=new Date(t.startTime),s=u(e),a=await g(s);a.sessions||(a.sessions=[]),a.sessions.push(t),a.visits++;const o=p(a.sessions);a.totalTime=o.totalTime,a.sites=o.sites,await T(s,a)}async function D(){return(await chrome.storage.local.get(i.ACTIVE_SESSIONS))[i.ACTIVE_SESSIONS]||{}}async function h(t){await chrome.storage.local.set({[i.ACTIVE_SESSIONS]:t})}async function U(t,e){const s=await D();s[t]=e,await h(s)}async function G(t){const e=await D(),s=e[t];return s&&(delete e[t],await h(e)),s}async function R(){await chrome.storage.local.remove(i.ACTIVE_SESSIONS)}async function _(t){const s=new TextEncoder().encode(t),a=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(a)).map(n=>n.toString(16).padStart(2,"0")).join("")}async function K(t,e){return await _(t)===e}function V(t,e){try{const a=new URL(t).hostname;if(e.startsWith("*.")){const o=e.slice(2);return a===o||a.endsWith("."+o)}return a===e||a==="www."+e}catch{return!1}}async function O(){return(await chrome.storage.local.get(i.DOMAIN_CATEGORIES))[i.DOMAIN_CATEGORIES]||{}}async function j(t,e){const s=await O();e===null?delete s[t]:s[t]=e,await chrome.storage.local.set({[i.DOMAIN_CATEGORIES]:s})}async function m(){return(await chrome.storage.local.get(i.DAILY_LIMITS))[i.DAILY_LIMITS]||[]}async function y(t){await chrome.storage.local.set({[i.DAILY_LIMITS]:t})}async function W(t){const e=await m(),s={...t,id:crypto.randomUUID()};return e.push(s),await y(e),s}async function H(t){const e=await m(),s=e.findIndex(a=>a.id===t.id);s!==-1&&(e[s]=t,await y(e))}async function P(t){const s=(await m()).filter(a=>a.id!==t);await y(s)}async function $(t){const e=await m(),s=u(),a=await g(s);for(const o of e){if(!o.enabled||o.bypassedUntil&&Date.now()<o.bypassedUntil)continue;const n=t.replace(/^www\./,""),c=o.pattern.replace(/^www\./,"");let l=!1;if(c.startsWith("*.")){const r=c.slice(2);l=n===r||n.endsWith("."+r)}else l=n===c;if(l){const r=a.sites[t]||a.sites["www."+t]||a.sites[n]||0,A=Math.max(0,o.limitSeconds-r);return{exceeded:r>=o.limitSeconds,limit:o,timeSpent:r,remaining:A}}}return{exceeded:!1,timeSpent:0,remaining:1/0}}export{K as A,V as B,G as C,R as D,D as a,W as b,$ as c,m as d,O as e,F as f,L as g,_ as h,w as i,b as j,v as k,f as l,x as m,N as n,d as o,S as p,C as q,P as r,j as s,B as t,H as u,k as v,g as w,Y as x,M as y,U as z};
