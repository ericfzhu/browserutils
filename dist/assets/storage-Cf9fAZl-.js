const p={trackingEnabled:!0,blockingEnabled:!0,youtubeTrackingEnabled:!1,theme:"system",retentionDays:30,idleThreshold:60,displayName:"",quickLinks:[]},i={BLOCKED_SITES:"blockedSites",BLOCKED_SITE_FOLDERS:"blockedSiteFolders",SETTINGS:"settings",DAILY_STATS:"dailyStats",ACTIVE_SESSIONS:"activeSessions",ACTIVE_YOUTUBE_SESSIONS:"activeYouTubeSessions",DOMAIN_CATEGORIES:"domainCategories",DAILY_LIMITS:"dailyLimits"};async function u(){return(await chrome.storage.local.get(i.BLOCKED_SITES))[i.BLOCKED_SITES]||[]}async function d(t){await chrome.storage.local.set({[i.BLOCKED_SITES]:t})}async function Y(t){const e=await u(),s={...t,id:crypto.randomUUID(),createdAt:Date.now()};return e.push(s),await d(e),s}async function B(t){const s=(await u()).filter(a=>a.id!==t);await d(s)}async function C(t){const e=await u(),s=e.findIndex(a=>a.id===t.id);s!==-1&&(e[s]=t,await d(e))}async function T(){return(await chrome.storage.local.get(i.BLOCKED_SITE_FOLDERS))[i.BLOCKED_SITE_FOLDERS]||[]}async function I(t){await chrome.storage.local.set({[i.BLOCKED_SITE_FOLDERS]:t})}async function k(t){const e=await T(),s={...t,id:crypto.randomUUID()};return e.push(s),await I(e),s}async function N(t){const e=await T(),s=e.findIndex(a=>a.id===t.id);s!==-1&&(e[s]=t,await I(e))}async function U(t){const s=(await T()).filter(n=>n.id!==t);await I(s);const o=(await u()).map(n=>n.folderId===t?{...n,folderId:void 0}:n);await d(o)}async function L(){const t=await chrome.storage.local.get(i.SETTINGS);return{...p,...t[i.SETTINGS]}}async function F(t){const s={...await L(),...t};return await chrome.storage.local.set({[i.SETTINGS]:s}),s}function S(t=new Date){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}async function m(t){const e=t||S();return((await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{})[e]||{date:e,totalTime:0,sites:{},visits:0,blockedAttempts:0,sessions:[]}}async function M(){return(await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{}}async function y(t,e){const a=(await chrome.storage.local.get(i.DAILY_STATS))[i.DAILY_STATS]||{};a[t]=e,await chrome.storage.local.set({[i.DAILY_STATS]:a})}async function x(t){const e=S(),s=await m(e);s.blockedAttempts++,await y(e,s)}function w(t){if(t.length===0)return{merged:[],totalSeconds:0};const e=[...t].sort((o,n)=>o.start-n.start),s=[e[0]];for(let o=1;o<e.length;o++){const n=e[o],c=s[s.length-1];n.start<=c.end?c.end=Math.max(c.end,n.end):s.push(n)}const a=s.reduce((o,n)=>o+Math.round((n.end-n.start)/1e3),0);return{merged:s,totalSeconds:a}}function O(t){const e=t.map(n=>({start:n.startTime,end:n.endTime})),{totalSeconds:s}=w(e),a=new Map;for(const n of t){const c=a.get(n.domain)||[];c.push({start:n.startTime,end:n.endTime}),a.set(n.domain,c)}const o={};for(const[n,c]of a){const{totalSeconds:r}=w(c);o[n]=r}return{totalTime:s,sites:o}}async function G(t){const e=new Date(t.startTime),s=S(e),a=await m(s);a.sessions||(a.sessions=[]),a.sessions.push(t),a.visits++;const o=O(a.sessions);a.totalTime=o.totalTime,a.sites=o.sites,await y(s,a)}function R(t){const e=new Map;for(const a of t){const o=a.channelId||a.channelName,n=e.get(o)||[];n.push({start:a.startTime,end:a.endTime}),e.set(o,n)}const s={};for(const[a,o]of e){const{totalSeconds:n}=w(o),c=t.find(r=>(r.channelId||r.channelName)===a);c&&(s[c.channelName]=n)}return s}async function V(t){const e=new Date(t.startTime),s=S(e),a=await m(s);a.youtubeSessions||(a.youtubeSessions=[]),a.youtubeSessions.push(t),await y(s,a)}async function h(){return(await chrome.storage.local.get(i.ACTIVE_YOUTUBE_SESSIONS))[i.ACTIVE_YOUTUBE_SESSIONS]||{}}async function E(t){await chrome.storage.local.set({[i.ACTIVE_YOUTUBE_SESSIONS]:t})}async function K(t,e){const s=await h();s[t]=e,await E(s)}async function j(t){const e=await h(),s=e[t];return s&&(delete e[t],await E(e)),s}async function H(){await chrome.storage.local.remove(i.ACTIVE_YOUTUBE_SESSIONS)}async function A(){return(await chrome.storage.local.get(i.ACTIVE_SESSIONS))[i.ACTIVE_SESSIONS]||{}}async function D(t){await chrome.storage.local.set({[i.ACTIVE_SESSIONS]:t})}async function W(t,e){const s=await A();s[t]=e,await D(s)}async function P(t){const e=await A(),s=e[t];return s&&(delete e[t],await D(e)),s}async function $(){await chrome.storage.local.remove(i.ACTIVE_SESSIONS)}async function v(t){const s=new TextEncoder().encode(t),a=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(a)).map(n=>n.toString(16).padStart(2,"0")).join("")}async function q(t,e){return await v(t)===e}function z(t,e){try{const a=new URL(t).hostname;if(e.startsWith("*.")){const o=e.slice(2);return a===o||a.endsWith("."+o)}return a===e||a==="www."+e}catch{return!1}}async function b(){return(await chrome.storage.local.get(i.DOMAIN_CATEGORIES))[i.DOMAIN_CATEGORIES]||{}}async function J(t,e){const s=await b();e===null?delete s[t]:s[t]=e,await chrome.storage.local.set({[i.DOMAIN_CATEGORIES]:s})}async function f(){return(await chrome.storage.local.get(i.DAILY_LIMITS))[i.DAILY_LIMITS]||[]}async function g(t){await chrome.storage.local.set({[i.DAILY_LIMITS]:t})}async function Q(t){const e=await f(),s={...t,id:crypto.randomUUID()};return e.push(s),await g(e),s}async function X(t){const e=await f(),s=e.findIndex(a=>a.id===t.id);s!==-1&&(e[s]=t,await g(e))}async function Z(t){const s=(await f()).filter(a=>a.id!==t);await g(s)}async function tt(t){const e=await f(),s=S(),a=await m(s);for(const o of e){if(!o.enabled||o.bypassedUntil&&Date.now()<o.bypassedUntil)continue;const n=t.replace(/^www\./,""),c=o.pattern.replace(/^www\./,"");let r=!1;if(c.startsWith("*.")){const l=c.slice(2);r=n===l||n.endsWith("."+l)}else r=n===c;if(r){const l=a.sites[t]||a.sites["www."+t]||a.sites[n]||0,_=Math.max(0,o.limitSeconds-l);return{exceeded:l>=o.limitSeconds,limit:o,timeSpent:l,remaining:_}}}return{exceeded:!1,timeSpent:0,remaining:1/0}}export{W as A,h as B,K as C,j as D,V as E,H as F,q as G,z as H,P as I,$ as J,A as a,tt as b,R as c,Q as d,f as e,b as f,L as g,v as h,U as i,I as j,N as k,k as l,T as m,x as n,F as o,u as p,d as q,Z as r,J as s,C as t,X as u,B as v,Y as w,m as x,M as y,G as z};
