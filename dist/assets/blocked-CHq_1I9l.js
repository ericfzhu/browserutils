import{r as l,j as e,a as G,R as Y}from"./index-BDzwN-5F.js";import{T as K,L as S,A as M}from"./timer-Bm5klgcZ.js";import{S as E,C as O}from"./shield-7p4-RiTW.js";function L(i){const x=Math.floor(i/3600),s=Math.floor(i%3600/60);return x>0?`${x}h ${s}m`:`${s}m`}function W(){const i=new Date,s=new Date(i.getFullYear(),i.getMonth(),i.getDate()+1,0,0,0).getTime()-i.getTime(),j=Math.floor(s/(1e3*60*60)),r=Math.floor(s%(1e3*60*60)/(1e3*60));return`${j}h ${r}m`}function V(i){return`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`}function q(){const[i,x]=l.useState("site"),[s,j]=l.useState(null),[r,C]=l.useState(null),[d,T]=l.useState(""),[p,n]=l.useState(""),[b,y]=l.useState(!1),[f,v]=l.useState(!1),[m,w]=l.useState(0);l.useEffect(()=>{D()},[]),l.useEffect(()=>{if(m>0){const t=setTimeout(()=>w(m-1),1e3);return()=>clearTimeout(t)}else f&&m===0&&(i==="site"?U():R())},[m,f,i]);async function D(){const t=new URLSearchParams(window.location.search),a=t.get("type"),o=t.get("site"),u=t.get("limitId");a==="limit"&&u?(x("limit"),await I(u)):o&&(x("site"),await B(o))}async function I(t){var a,o,u;try{const[N,c]=await Promise.all([chrome.runtime.sendMessage({type:"GET_DAILY_LIMITS"}),chrome.runtime.sendMessage({type:"GET_STATS",payload:{date:V(new Date)}})]),h=N.find(g=>g.id===t);if(h){const g=h.pattern.replace(/^www\./,""),$=((a=c==null?void 0:c.sites)==null?void 0:a[g])||((o=c==null?void 0:c.sites)==null?void 0:o["www."+g])||((u=c==null?void 0:c.sites)==null?void 0:u[h.pattern])||0;C({limit:h,timeSpent:$}),await chrome.runtime.sendMessage({type:"INCREMENT_BLOCKED_ATTEMPT",payload:{domain:h.pattern}})}}catch(N){console.error("Failed to load limit:",N)}}async function B(t){try{const o=(await chrome.runtime.sendMessage({type:"GET_BLOCKED_SITES"})).find(u=>u.id===t);j(o||null),o&&await chrome.runtime.sendMessage({type:"INCREMENT_BLOCKED_ATTEMPT",payload:{domain:o.pattern}})}catch(a){console.error("Failed to load site:",a)}}async function F(t){if(t.preventDefault(),!(!s||!d)){y(!0),n("");try{const a=await chrome.runtime.sendMessage({type:"UNLOCK_SITE",payload:{id:s.id,password:d}});a.success?window.history.back():n(a.error||"Failed to unlock")}catch(a){console.error("Failed to unlock:",a),n("Failed to unlock site")}finally{y(!1)}}}function _(){s!=null&&s.timerDuration&&(w(5),v(!0))}async function U(){if(s)try{(await chrome.runtime.sendMessage({type:"UNLOCK_SITE",payload:{id:s.id}})).success&&window.history.back()}catch(t){console.error("Failed to unlock:",t)}}function k(){window.history.back()}function A(){if(!r)return;const t=r.limit.cooldownSeconds||30;w(t),v(!0)}async function R(){if(r)try{const t=await chrome.runtime.sendMessage({type:"BYPASS_DAILY_LIMIT",payload:{id:r.limit.id}});t.success?window.history.back():n(t.error||"Failed to bypass limit")}catch(t){console.error("Failed to bypass limit:",t),n("Failed to bypass limit")}}async function P(t){if(t.preventDefault(),!(!r||!d)){y(!0),n("");try{const a=await chrome.runtime.sendMessage({type:"BYPASS_DAILY_LIMIT",payload:{id:r.limit.id,password:d}});a.success?window.history.back():n(a.error||"Failed to bypass limit")}catch(a){console.error("Failed to bypass limit:",a),n("Failed to bypass limit")}finally{y(!1)}}}return i==="limit"&&r?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(K,{className:"w-8 h-8 text-amber-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Daily Limit Reached"}),e.jsx("p",{className:"text-gray-500",children:e.jsx("span",{className:"font-medium text-gray-700",children:r.limit.pattern})})]}),e.jsxs("div",{className:"bg-amber-50 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-amber-800",children:"Time spent today"}),e.jsx("span",{className:"font-medium text-amber-900",children:L(r.timeSpent)})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-amber-800",children:"Daily limit"}),e.jsx("span",{className:"font-medium text-amber-900",children:L(r.limit.limitSeconds)})]}),e.jsx("div",{className:"h-2 bg-amber-200 rounded-full overflow-hidden mt-3",children:e.jsx("div",{className:"h-full bg-amber-500 rounded-full",style:{width:"100%"}})})]}),e.jsxs("p",{className:"text-sm text-gray-500 text-center mb-6",children:["Limit resets in ",W()]}),r.limit.bypassType==="cooldown"&&e.jsx("div",{className:"space-y-4",children:f?m>0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-4xl font-bold text-amber-600 mb-2",children:m}),e.jsx("p",{className:"text-sm text-gray-500",children:"Taking a moment to reconsider..."})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-amber-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Granting access..."})]}):e.jsxs("button",{onClick:A,className:"w-full bg-amber-600 hover:bg-amber-700 text-white py-3 rounded-lg transition-colors",children:["Wait ",r.limit.cooldownSeconds||30,"s to continue"]})}),r.limit.bypassType==="password"&&e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-4",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"Enter password to continue for 15 minutes"})]}),e.jsx("input",{type:"password",value:d,onChange:t=>{T(t.target.value),n("")},placeholder:"Enter password",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500",autoFocus:!0}),p&&e.jsx("p",{className:"text-sm text-red-600",children:p}),e.jsx("button",{type:"submit",disabled:b||!d,className:"w-full bg-amber-600 hover:bg-amber-700 disabled:opacity-50 text-white py-3 rounded-lg transition-colors",children:b?"Verifying...":"Continue for 15 minutes"})]}),r.limit.bypassType==="none"&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-600",children:"This limit cannot be bypassed. Check back after midnight."})}),e.jsxs("button",{onClick:k,className:"w-full mt-4 flex items-center justify-center gap-2 text-gray-600 hover:text-gray-900 py-2 transition-colors",children:[e.jsx(M,{className:"w-4 h-4"}),"Go Back"]}),e.jsx("div",{className:"mt-6 pt-6 border-t text-center",children:e.jsx("a",{href:chrome.runtime.getURL("dashboard.html#/limits"),className:"text-sm text-amber-600 hover:text-amber-700",children:"Manage daily limits in dashboard"})})]})}):s?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(E,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Site Blocked"}),e.jsxs("p",{className:"text-gray-500",children:[e.jsx("span",{className:"font-medium text-gray-700",children:s.pattern})," is blocked"]})]}),s.unlockType==="password"&&e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-4",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"Enter password to unlock temporarily"})]}),e.jsx("input",{type:"password",value:d,onChange:t=>{T(t.target.value),n("")},placeholder:"Enter password",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0}),p&&e.jsx("p",{className:"text-sm text-red-600",children:p}),e.jsx("button",{type:"submit",disabled:b||!d,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white py-3 rounded-lg transition-colors",children:b?"Unlocking...":"Unlock Site"})]}),s.unlockType==="timer"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-4",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:["Wait ",s.timerDuration," minutes to unlock"]})]}),f?m>0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:m}),e.jsx("p",{className:"text-sm text-gray-500",children:"Taking a moment to reconsider..."})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Unlocking..."})]}):e.jsxs("button",{onClick:_,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition-colors",children:["Start Timer (",s.timerDuration," min access)"]})]}),s.unlockType==="none"&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-600",children:"This site is permanently blocked. Go to the dashboard to change settings."})}),s.unlockType==="schedule"&&s.schedule&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-gray-600 mb-2",children:"This site is blocked during scheduled hours."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Blocked: ",s.schedule.startTime," - ",s.schedule.endTime]})]}),e.jsxs("button",{onClick:k,className:"w-full mt-4 flex items-center justify-center gap-2 text-gray-600 hover:text-gray-900 py-2 transition-colors",children:[e.jsx(M,{className:"w-4 h-4"}),"Go Back"]}),e.jsx("div",{className:"mt-6 pt-6 border-t text-center",children:e.jsx("a",{href:chrome.runtime.getURL("dashboard.html#/blocked"),className:"text-sm text-blue-600 hover:text-blue-700",children:"Manage blocked sites in dashboard"})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Site Blocked"}),e.jsx("p",{className:"text-gray-600",children:"This site has been blocked by BrowserUtils."})]})})}G.createRoot(document.getElementById("root")).render(e.jsx(Y.StrictMode,{children:e.jsx(q,{})}));
